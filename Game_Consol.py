import random
import time
from rich.console import Console
from rich.table import Table
from rich.panel import Panel
from rich.prompt import Prompt
from art import text2art

console = Console()

console.print(Panel.fit("[bold cyan]Введите имя вашего героя:[/bold cyan]", title="Добро пожаловать в игру"))
hero_name = input()

stats = {
    "здоровье": 100,
    "выносливость": 30,
    "сила заклинаний": 20,
    "разум": 20,
    "отношения": 30
}

debuffs = {
    "слабость": 0,        # Влияет на физическую активность, снижает эффективность
    "истощение": 0,       # Влияет на выносливость, снижает эффективность магии
    "стресс": 0,          # Влияет на разум, снижает точность заклинаний
    "ошибки в заклинаниях": 0,  # Уменьшает урон от заклинаний
    "ошибки в восприятии": 0    # Увеличивает шанс получить больше урона
}

debuff_threshold = {
    "здоровье": 30,
    "выносливость": 20,
    "разум": 10
}

critical_threshold = {
    "здоровье": 0,
    "выносливость": -15,
    "разум": -25
}

companions = {
    "1": {"name": "Вульпафила", "бонус": {"разум": 10, "бонус к отношениям": 5}},
    "2": {"name": "Смит", "бонус": {"выносливость": 15, "бонус к отношениям": 5}},
    "3": {"name": "Кубрау", "бонус": {"здоровье": 20, "бонус к отношениям": 5}},
    "4": {"name": "Гельминт", "бонус": {"сила заклинаний": 10, "бонус к отношениям": 5}}
}

console.print("\n[bold cyan]Выберите компаньона:[/bold cyan]")
for i, companion in companions.items():
    console.print(f"{i}. {companion['name']}")

companion_choice = Prompt.ask("\nВведите номер выбранного питомца", choices=["1", "2", "3", "4"])

chosen_companion = companions[companion_choice]["name"]
for stat, value in companions[companion_choice]["бонус"].items():
    if stat != "бонус к отношениям":
        stats[stat] += value

console.print(f"\n{hero_name} выбрал компаньона {chosen_companion}.\n")

def print_stats(changed_stats):
    table = Table(title="Текущие характеристики")
    table.add_column("Характеристика", style="cyan")
    table.add_column("Значение", style="magenta")
    for key, value in stats.items():
        table.add_row(key.capitalize(), str(value))
    console.print(table)
    if changed_stats:
        console.print("\n[bold yellow]Изменения за день:[/bold yellow]")
        for stat, value in changed_stats.items():
            change_sign = "+" if value > 0 else ""
            console.print(f"[bold cyan]{stat.capitalize()} {change_sign}{value}[/bold cyan]")

def print_stats_boss(changed_stats):
    table = Table(title="Текущие характеристики")
    table.add_column("Характеристика", style="cyan")
    table.add_column("Значение", style="magenta")
    for key, value in stats.items():
        table.add_row(key.capitalize(), str(value))
    console.print(table)
    for stat, value in changed_stats.items():
        change_sign = "+" if value > 0 else ""
        console.print(f"[bold cyan]{stat.capitalize()} {change_sign}{value}[/bold cyan]")

def apply_debuffs():
    global debuffs
    if stats["здоровье"] < debuff_threshold["здоровье"]:
        debuffs["слабость"] += 1
        console.print("[bold red]Ваше здоровье ухудшается, и слабость нарастает.[/bold red]")
    if stats["выносливость"] < debuff_threshold["выносливость"]:
        debuffs["истощение"] += 1
        console.print("[bold red]Вы чувствуете истощение. Даже простые задачи становятся трудными.[/bold red]")
    if stats["разум"] < debuff_threshold["разум"]:
        debuffs["стресс"] += 1
        debuffs["ошибки в заклинаниях"] += 1
        debuffs["ошибки в восприятии"] += 1
        console.print("[bold red]Ваш разум под воздействием стресса, начинаются ошибки в заклинаниях и восприятии.[/bold red]")

daily_events = {
    1: {
        "утро": [
            {"событие": "Вы идете в лес, где туман сгущается.", "реплика": "Лес охватывает вас страхом, но дает вам магическую силу.", "эффект": {"сила заклинаний": 10, "разум": -5}},
            {"событие": "Вы решаете отдохнуть у реки.", "реплика": "Текучая вода приносит умиротворение, но что-то беспокоит вас.", "эффект": {"разум": 5, "выносливость": -5}},
            {"событие": "Вы проходите через старый мост в развалины.", "реплика": "Ощущаете сильное магическое присутствие, но вас охватывает тревога.", "эффект": {"разум": -5, "сила заклинаний": 15}},
            {"событие": "Встречаете загадочного путника.", "реплика": "Он предлагает древние знания, но забирает часть вашей энергии.", "эффект": {"разум": 10, "здоровье": -10}}
        ],
        "день": [
            {"событие": "Лес затягивает вас глубже.", "реплика": "Вы чувствуете нарастающую магическую силу, но лес забирает вашу энергию.", "эффект": {"выносливость": -10, "сила заклинаний": 20}},
            {"событие": "Магическое существо обещает исполнить желание.", "реплика": "Вы ощущаете усиление магии, но часть вашей души уходит.", "эффект": {"сила заклинаний": 15, "разум": -5}}
        ],
        "вечер": [
            {"событие": "Тени сгущаются вокруг лагеря.", "реплика": "Вы чувствуете себя уязвимым, но находите внутренние силы.", "эффект": {"разум": -5, "выносливость": 5}},
            {"событие": "Появляется старый торговец.", "реплика": "Вы покупаете артефакт, который увеличивает вашу магию, но ослабляет тело.", "эффект": {"сила заклинаний": 15, "здоровье": -5}}
        ]
    },
    2: {
        "утро": [
            {"событие": "Вы видите странное существо на рассвете.", "реплика": "Оно исчезает, оставив за собой тревогу.", "эффект": {"разум": -5, "выносливость": 10}},
            {"событие": "Вы слышите зов из глубины леса.", "реплика": "Голос обещает силу, но вам становится не по себе.", "эффект": {"сила заклинаний": 10, "разум": -5}},
            {"событие": "Вы находите заброшенную деревню.", "реплика": "Время здесь остановилось, и что-то угрожает вам.", "эффект": {"разум": -5, "сила заклинаний": 10}},
            {"событие": "Мудрец предлагает старинное заклинание.", "реплика": "Его знание помогает, но вы чувствуете себя опустошенным.", "эффект": {"сила заклинаний": 15, "здоровье": -10}}
        ],
        "день": [
            {"событие": "Магический дождь покрывает лес.", "реплика": "Дождь усиливает магию, но забирает жизненные силы.", "эффект": {"сила заклинаний": 20, "здоровье": -10}},
            {"событие": "Вы находите круг древних камней.", "реплика": "Камни усиливают магию, но ослабляют тело.", "эффект": {"сила заклинаний": 15, "выносливость": -10}}
        ],
        "вечер": [
            {"событие": "Тьма окутывает землю.", "реплика": "Вы чувствуете страх, но свет пробивается через мрак.", "эффект": {"разум": 5, "сила заклинаний": 10}},
            {"событие": "Загадочные огни зовут вас к себе.", "реплика": "Огни усиливают вашу магию, но наполняют вас страхом.", "эффект": {"сила заклинаний": 10, "разум": -5}}
        ]
    },
    3: {
        "утро": [
            {"событие": "Вы видите странный свет в лесу.", "реплика": "Свет наполняет вас магией, но разъедает ваш разум.", "эффект": {"сила заклинаний": 10, "разум": -10}},
            {"событие": "Путник предлагает помощь.", "реплика": "Он дарует вам силу, но ваше тело начинает слабеть.", "эффект": {"сила заклинаний": 15, "выносливость": -5}}
        ],
        "день": [
            {"событие": "Артефакт в лесу усиливает вашу магию.", "реплика": "Артефакт дарует вам силу, но ослабляет тело.", "эффект": {"сила заклинаний": 20, "выносливость": -10}},
            {"событие": "Вы находите древний портал.", "реплика": "Проход через портал даёт вам знание, но разрушает ваш разум.", "эффект": {"сила заклинаний": 15, "разум": -10}}
        ],
        "вечер": [
            {"событие": "Странные звуки доносятся из тьмы.", "реплика": "Вы чувствуете страх, но находите внутренние силы.", "эффект": {"сила заклинаний": 10, "разум": -5}},
            {"событие": "Старые руины источают магию.", "реплика": "Руины даруют магическую силу, но поглощают ваше здоровье.", "эффект": {"сила заклинаний": 15, "здоровье": -10}}
        ]
    },
    4: {
        "утро": [
            {"событие": "На рассвете вы ощущаете странную силу.", "реплика": "Энергия наполняет вас, но она подавляет ваш разум.", "эффект": {"сила заклинаний": 15, "разум": -5}},
            {"событие": "Древний дух появляется из тумана.", "реплика": "Дух дарует вам магические силы, но ослабляет тело.", "эффект": {"сила заклинаний": 10, "здоровье": -5}}
        ],
        "день": [
            {"событие": "Тьма сгущается вокруг вас.", "реплика": "Каждый шаг вперед дается с трудом, но вы черпаете силу.", "эффект": {"выносливость": -10, "сила заклинаний": 20}},
            {"событие": "Вы ощущаете невидимую магическую стену.", "реплика": "Проход через неё истощает тело, но усиливает разум.", "эффект": {"выносливость": -5, "разум": 10}}
        ],
        "вечер": [
            {"событие": "Ваша тень кажется живой.", "реплика": "Она шепчет вам заклинания, но вызывает чувство страха.", "эффект": {"сила заклинаний": 10, "разум": -5}},
            {"событие": "Вы находите магический свиток.", "реплика": "Он дарует могущество, но забирает часть вашей жизненной силы.", "эффект": {"сила заклинаний": 15, "здоровье": -10}}
        ]
    },
    5: {
        "утро": [
            {"событие": "Небо охватывают тучи, и начинается шторм.", "реплика": "Вы черпаете силу из молний, но ваши нервы на пределе.", "эффект": {"сила заклинаний": 20, "разум": -10}},
            {"событие": "Земля дрожит под ногами.", "реплика": "Это дрожание пугает вас, но вы чувствуете силу, исходящую из земли.", "эффект": {"выносливость": 10, "разум": -5}}
        ],
        "день": [
            {"событие": "Древнее существо появляется перед вами.", "реплика": "Оно предлагает вам свою силу, но требует часть вашей жизни.", "эффект": {"сила заклинаний": 20, "здоровье": -15}},
            {"событие": "Тьма затягивает вас в свои объятия.", "реплика": "Каждый шаг вперед вызывает боль, но вы становитесь сильнее.", "эффект": {"выносливость": -15, "сила заклинаний": 25}}
        ],
        "вечер": [
            {"событие": "Звёзды мерцают ярко на небе.", "реплика": "Каждая звезда шепчет вам заклинания, но от этого голова идет кругом.", "эффект": {"сила заклинаний": 10, "разум": -10}},
            {"событие": "Вы находите древний магический круг.", "реплика": "Его магия усиливает вас, но требует жертвы.", "эффект": {"сила заклинаний": 15, "здоровье": -10}}
        ]
    }
}

def perform_event(time_of_day, day):
    changed_stats = {}
    console.print(f"\n=== [bold yellow]День {day}, {time_of_day.capitalize()} ===")
    events = daily_events[day][time_of_day]
    for i, event in enumerate(events):
        console.print(f"{i + 1}. {event['событие']}")
    choice = Prompt.ask("\nВаш выбор", choices=[str(i + 1) for i in range(len(events))])
    chosen_event = events[int(choice) - 1]
    console.print(f"\n[bold cyan]{chosen_event['реплика']}[/bold cyan]")
    for stat, value in chosen_event["эффект"].items():
        stats[stat] += value
        changed_stats[stat] = value
    return changed_stats
def check_critical_stats():
    if stats["здоровье"] <= critical_threshold["здоровье"]:
        console.print("[bold red]Ваше здоровье упало до критического уровня. Вы не в состоянии продолжать своё путешествие. Путешествие окончено.[/bold red]")
        return True
    elif stats["выносливость"] <= critical_threshold["выносливость"]:
        console.print("[bold red]Ваше тело слишком истощено. Вы больше не способны продолжать. Путешествие завершено.[/bold red]")
        return True
    elif stats["разум"] <= critical_threshold["разум"]:
        console.print("[bold red]Ваш разум помутился, и вы больше не можете различать реальность. Путешествие закончено.[/bold red]")
        return True
    return False
def battle_with_boss():
    boss_art = text2art("BOSSFIGHT")
    print_stats_boss(changed_stats)
    console.print(f"\n[bold red]{boss_art}[/bold red]")
    boss_stats = {
        "здоровье": 400,
        "сила атаки": 60
    }
    console.print("\n[bold red]Битва с Боссом начинается![/bold red]")
    while boss_stats["здоровье"] > 0 and stats["здоровье"] > 0:
        check_critical_stats()
        console.print(f"\n[bold cyan]Ваши характеристики:[/bold cyan] Здоровье: {stats['здоровье']}, Сила заклинаний: {stats['сила заклинаний']}")
        console.print(f"[bold red]Здоровье босса:[/bold red] {boss_stats['здоровье']}\n")
        console.print(f"[bold magenta]Ваши дебаффы:[/bold magenta]")

        for debuff, active in debuffs.items():
            if active:
                console.print(f"[bold red]- {debuff.capitalize()}[/bold red]")
        action = Prompt.ask("\nВаш выбор (1 - Атака магией, 2 - Защита)", choices=["1", "2"], default="1", show_choices=False)
        if action == "1":
            damage = stats["сила заклинаний"] + random.randint(5, 20)
            if debuffs["ошибки в заклинаниях"] > 0:
                damage = max(0, damage - debuffs["ошибки в заклинаниях"] * 5)  # Ошибки уменьшают урон
            boss_stats["здоровье"] -= damage
            console.print(f"\nВы атаковали босса и нанесли {damage} урона!")
        elif action == "2":
            block = random.randint(10, 25)
            boss_damage = max(0, boss_stats["сила атаки"] - block)
            stats["здоровье"] -= boss_damage
            console.print(f"\nВы защитились, блокировав {block} урона. Босс наносит {boss_damage} урона.")
        if boss_stats["здоровье"] > 0:
            boss_attack = random.randint(25, 40)
            if debuffs["ошибки в восприятии"] > 0:
                boss_attack += debuffs["ошибки в восприятии"] * 5  # Ошибки в восприятии увеличивают получаемый урон

            if debuffs["слабость"] > 0:
                # Слабость снижает способность героя защищаться, увеличивая урон от атаки босса
                boss_attack += debuffs["слабость"] * 3

            if debuffs["истощение"] > 0:
                # Истощение уменьшает максимальную выносливость героя, влияя на сопротивляемость урону
                stats["выносливость"] = max(0, stats["выносливость"] - debuffs["истощение"] * 2)

            if debuffs["стресс"] > 0:
                # Стресс влияет на разум героя, снижая его способность блокировать атаку
                boss_attack += debuffs["стресс"] * 2

            console.print(f"\n[bold red]Босс атакует![/bold red] Он наносит {boss_attack} урона.")
        if check_critical_stats():
            return
    if stats["здоровье"] <= 0:
        console.print("\n[bold red]Вы проиграли. Босс оказался слишком сильным.[/bold red]")
    else:
        console.print("\n[bold green]Вы победили босса! Поздравляем![/bold green]")

for day in range(1, 6):
    console.print(f"\n=== [bold yellow]День {day} начинается! ===")
    changed_stats = {}

    # Утреннее событие
    morning_changes = perform_event("утро", day)
    for stat, value in morning_changes.items():
        changed_stats[stat] = changed_stats.get(stat, 0) + value
    check_critical_stats
    # Дневное событие
    day_changes = perform_event("день", day)
    for stat, value in day_changes.items():
        changed_stats[stat] = changed_stats.get(stat, 0) + value

    check_critical_stats()


    # Вечернее событие
    evening_changes = perform_event("вечер", day)
    for stat, value in evening_changes.items():
        changed_stats[stat] = changed_stats.get(stat, 0) + value
    apply_debuffs()

    # Показ изменений характеристик за день
    console.print(f"\n=== [bold yellow]Конец дня {day} ===")
    print_stats(changed_stats)

    if day == 5:
        battle_with_boss()

    time.sleep(2)
